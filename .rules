llumen is a LLM chat application. featuring three mode: normal chat, search and deep research.

# Rust coding guidelines

* Prioritize code correctness and clarity. Speed and efficiency are secondary priorities unless otherwise specified.
* Do not write organizational or comments that summarize the code. Comments should only be written in order to explain "why" the code is written in some way in the case there is a reason that is tricky / non-obvious.
* Prefer implementing functionality in existing files unless it is a new logical component. Avoid creating many small files.
* Avoid using functions that panic like `unwrap()`, instead use mechanisms like `?` to propagate errors.
* Be careful with operations like indexing which may panic if the indexes are out of bounds.
* Never silently discard errors with `let _ =` on fallible operations. Always handle errors appropriately:
  - Propagate errors with `?` when the calling function should handle them
  - Use `.log_err()` or similar when you need to ignore errors but want visibility
  - Use WithKind trait to propagate error to frontend
  - Use explicit error handling with `match` or `if let Err(...)` when you need custom logic
  - Example: avoid `let _ = client.request(...).await?;` - use `client.request(...).await?;` instead
  Example:
  ```rust
  pub trait WithKind<T> {
      fn kind(self, kind: ErrorKind) -> Result<T, Json<Error>>;
      fn raw_kind(self, kind: ErrorKind) -> Result<T, Error>;
  }
  impl<T, E> WithKind<T> for Result<T, E>;
  ```
* When implementing async operations that may fail, ensure errors propagate to the UI layer so users get meaningful feedback.
* Never create files with `mod.rs` paths - prefer `src/some_module.rs` instead of `src/some_module/mod.rs`.
* When creating new crates, prefer specifying the library root path in `Cargo.toml` using `[lib] path = "...rs"` instead of the default `lib.rs`, to maintain consistent and descriptive naming (e.g., `gpui.rs` or `main.rs`).
* Avoid creative additions unless explicitly requested
* Use full words for variable names (no abbreviations like "q" for "queue")
* Use variable shadowing to scope clones in async contexts for clarity, minimizing the lifetime of borrowed references.
  Example:
  ```rust
  executor.spawn({
      let task_ran = task_ran.clone();
      async move {
          *task_ran.borrow_mut() = true;
      }
  });
  ```

# Svelte State Management

`frontend/src/lib/api/state/index.ts` emphasizes small bundle sizes by omitting advanced features like automatic deduplication in queries and signal-based inputs.
Instead, it relies on manual top-level invocation (e.g., via setContext) for sharing queries across components.

```ts
export function useRoom(id: number): QueryResult<ChatReadResp> {
	return CreateQuery<ChatReadReq, ChatReadResp>({
		key: ['chatRead', id.toString()],
		path: 'chat/read',
		body: { id },
		revalidateOnFocus: false,
		staleTime: Infinity
	});
}
```

## backend tech stack
* Rust
* Axum
* SeaORM
* Tokio

## frontend tech stack
* Svelte 5(SPA)
* TailwindCSS
* Vite
* TypeScript
* bit-ui

## Project structure

```
├── backend
│   ├── entity    # database entity definitions
│   ├── migration # database migration
│   ├── runner    # code sandbox base on lua
│   └── src
├── frontend
│   ├── src
│   └── static
├── package       # scripts for building and releasing
│   ├── build-artifacts.sh
│   ├── build-artifacts-windows.sh
│   ├── Dockerfile
│   └── install-zig.sh
└── prompts      # prompt templates
```

### backend structure

```
backend/src
├── chat       # Chat for each mode
│   ├── channel.rs
│   ├── context.rs
│   ├── mod.rs
│   ├── process
│   ├── processes
│   ├── prompt.rs
│   └── token.rs
├── middlewares # middlewares
│   ├── auth.rs
│   ├── cache_control.rs
│   ├── compression.rs
│   ├── logger.rs
│   └── mod.rs
├── openrouter  # openrouter API client
│   ├── completion.rs
│   ├── mod.rs
│   ├── raw.rs
│   └── stream.rs
├── routes       # API route handlers
│   ├── auth
│   ├── chat
│   ├── file
│   ├── message
│   ├── model
│   ├── mod.rs
│   └── user
└── utils
```

### Frontend structure

```
frontend/src
├── app.css
├── lib
│   ├── api
│   ├── components
│   ├── messages
│   ├── preference
│   └── ui
└── routes
```
